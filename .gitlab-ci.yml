stages:
  - build
  - deploy

build:
  stage: build

  only:
    - master
    - merge_requests
    - triggers

  script:
    - npm install
    - npm run build

  artifacts:
    paths:
      - ./dist/
    expire_in: '6h'


deploy:
  stage: deploy

  only:
    - master
    - triggers

  environment:
    name: production
    url: https://oleb.it/

  variables:
    dir_root: /var/www/
    webspace: oleb/vue/

  script:
    - "target=$dir_root$webspace"
    - "echo \"Deploying to: $target\""
    - "rsync -rlvc --delete ./dist/ $target"
    - "chgrp -hR www-data $target/*"
